{
    "version": "2.1",
    "device_type": "xiaomi_smart_band_10",
    "display_name": "Xiaomi Smart Band 10 (FE95 Protocol V2)",
    "service_filter": [
        "0000FE95-0000-1000-8000-00805F9B34FB"
    ],
    "services": {
        "FE95": {
            "uuid": "0000FE95-0000-1000-8000-00805F9B34FB",
            "name": "Xiaomi Encrypted Service",
            "characteristics": {
                "heart_rate_measurement": {
                    "uuid": "00002A37-0000-1000-8000-00805F9B34FB",
                    "parser": "heart_rate_measurement",
                    "data_type": "heart_rate",
                    "properties": [
                        "notify"
                    ]
                },
                "battery_level": {
                    "uuid": "00002A19-0000-1000-8000-00805F9B34FB",
                    "parser": "battery_level",
                    "data_type": "battery",
                    "properties": [
                        "read",
                        "notify"
                    ],
                    "disabled": true,
                    "note": "❌ DISABLED: Xiaomi Smart Band 10 does NOT support BLE characteristic reads after BT_CLASSIC SPP connection is established. Device is encrypted only on SPP channel. Use SPP protocol instead (XiaomiSppService via protobuf command)"
                },
                "device_info": {
                    "uuid": "00000050-0000-1000-8000-00805F9B34FB",
                    "properties": [
                        "read"
                    ],
                    "description": "Device information - firmware version, hardware revision, etc. (Read-only)"
                },
                "command_read": {
                    "uuid": "0000005E-0000-1000-8000-00805F9B34FB",
                    "properties": [
                        "write_no_response",
                        "notify"
                    ],
                    "description": "Xiaomi SPP Protocol V2 - RX characteristic for receiving responses FROM Smart Band 10 (Gadgetbridge: BLE_V2_CHARACTERISTIC_RX). Note: Has both write and notify properties."
                },
                "command_write": {
                    "uuid": "0000005F-0000-1000-8000-00805F9B34FB",
                    "properties": [
                        "write_no_response",
                        "notify"
                    ],
                    "description": "Xiaomi SPP Protocol V2 - TX characteristic for sending commands TO Smart Band 10 (Gadgetbridge: BLE_V2_CHARACTERISTIC_TX). Note: Has both write and notify properties."
                },
                "activity_data": {
                    "uuid": "00000053-0000-1000-8000-00805F9B34FB",
                    "parser": "xiaomi_activity_data",
                    "data_type": "movement",
                    "properties": [
                        "notify"
                    ],
                    "description": "Activity data stream - includes steps, movement intensity, SpO2 (polled every 60 seconds)",
                    "polling_interval_seconds": 60
                },
                "realtime_steps": {
                    "uuid": "00000007-0000-3512-2118-0009AF100700",
                    "parser": "xiaomi_realtime_steps",
                    "data_type": "movement",
                    "properties": [
                        "notify",
                        "read"
                    ],
                    "description": "Real-time step counter (updates every 1-5 seconds)"
                }
            }
        },
        "FEE1": {
            "uuid": "0000FEE1-0000-1000-8000-00805F9B34FB",
            "name": "Xiaomi Extended Service",
            "characteristics": {
                "spo2_data": {
                    "uuid": "00000005-0000-3512-2118-0009AF100700",
                    "parser": "xiaomi_activity_file",
                    "data_type": "spo2",
                    "properties": [
                        "notify"
                    ],
                    "description": "SpO2 samples from activity files (polled every 60-300 seconds depending on all-day monitoring setting)",
                    "polling_interval_seconds": 300
                }
            }
        }
    },
    "data_parsers": {
        "xiaomi_heart_rate": {
            "type": "heart_rate",
            "class": "GenericHeartRateParser",
            "description": "Standard BLE Heart Rate Measurement (0x2A37) - REUSES generic parser"
        },
        "xiaomi_battery_level": {
            "type": "battery",
            "class": "GenericBatteryLevelParser",
            "description": "Standard BLE Battery Level (0x2A19) - REUSES generic parser"
        },
        "xiaomi_activity_data": {
            "type": "movement",
            "class": "XiaomiActivityDataParser",
            "description": "Xiaomi activity stream - steps, intensity, ENMO. Polled every 60s during monitoring."
        },
        "xiaomi_realtime_steps": {
            "type": "movement",
            "class": "XiaomiRealtimeStepsParser",
            "description": "Real-time step counter - total steps. Updates every 1-5s when movement detected."
        },
        "xiaomi_spo2": {
            "type": "spo2",
            "class": "XiaomiSpo2Parser",
            "description": "⚠️ NOT IMPLEMENTED YET - SpO2 from activity files. Requires authentication."
        }
    },
    "authentication": {
        "protocol": "xiaomi_spp",
        "connection_type": "spp_over_ble",
        "service_uuid": "0000FE95-0000-1000-8000-00805F9B34FB",
        "command_read_uuid": "0000005E-0000-1000-8000-00805F9B34FB",
        "command_write_uuid": "0000005F-0000-1000-8000-00805F9B34FB",
        "encryption_required": true,
        "spp_protocol": {
            "version": "v2",
            "version_detection": {
                "enabled": true,
                "send_version_request_v1": true,
                "channel": 0,
                "opcode": 0,
                "timeout_ms": 5000,
                "auto_switch_threshold": 2,
                "note": "Send VERSION request in V1 format, parse response byte[0]. If >= 2, switch to V2."
            },
            "v1": {
                "packet_preamble": [
                    186,
                    220,
                    254
                ],
                "packet_epilogue": [
                    239
                ],
                "channels": {
                    "version": 0,
                    "proto_rx": 1,
                    "proto_tx": 2,
                    "authentication": 2,
                    "fitness": 3,
                    "voice": 4,
                    "mass": 5,
                    "ota": 7
                },
                "opcodes": {
                    "read": 0,
                    "send": 2
                },
                "data_types": {
                    "plain": 0,
                    "encrypted": 1,
                    "auth": 2
                }
            },
            "v2_note": "All SPP V2 protocol values are UNIVERSAL across Xiaomi devices (hardcoded in code). See lib/shared/services/bluetooth/xiaomi/protocol/v2/constants.dart"
        },
        "auth_flow": {
            "step_0": "Send VERSION request (V1 format) → Receive version byte → Auto-switch to V2 if >= 2",
            "step_1_v2": "Send SESSION_CONFIG request (opcode=1) → Receive SESSION_CONFIG response (opcode=2)",
            "step_2": "Send CMD_NONCE (type=1, subtype=26) with phoneNonce as SPP V2 DATA packet",
            "step_3": "Receive watchNonce + HMAC verification as SPP V2 DATA packet → Send ACK",
            "step_4": "Send CMD_AUTH (type=1, subtype=27) with encrypted device info as SPP V2 DATA packet",
            "step_5": "Receive confirmation (status=1 for success) as SPP V2 DATA packet → Send ACK"
        },
        "notes": "Smart Band 10 CONFIRMED to use SPP Protocol V2 (Gadgetbridge source code MiBand10Coordinator.java). Requires session handshake before authentication. Auto-detected via VERSION request. Based on Gadgetbridge XiaomiSppProtocolV2.java + XiaomiSppPacketV2.java"
    }
}