{
    "version": "2.1",
    "device_type": "xiaomi_smart_band_9",
    "display_name": "Xiaomi Smart Band 9 (SPP Auto-detect V1/V2)",
    "service_filter": [
        "0000FE95-0000-1000-8000-00805F9B34FB"
    ],
    "services": {
        "FE95": {
            "uuid": "0000FE95-0000-1000-8000-00805F9B34FB",
            "name": "Xiaomi Encrypted Service",
            "characteristics": {
                "command_write": {
                    "uuid": "00000051-0000-1000-8000-00805F9B34FB",
                    "properties": [
                        "write_no_response"
                    ],
                    "description": "Xiaomi SPP Protocol V1 - AUTH ONLY: TX characteristic for sending auth commands during BLE authentication phase"
                },
                "command_read": {
                    "uuid": "00000052-0000-1000-8000-00805F9B34FB",
                    "properties": [
                        "notify"
                    ],
                    "description": "Xiaomi SPP Protocol V1 - AUTH ONLY: RX characteristic for receiving auth responses during BLE authentication phase"
                }
            }
        }
    },
    "data_parsers": {},
    "authentication": {
        "protocol": "xiaomi_spp",
        "connection_type": "spp_over_ble",
        "service_uuid": "0000FE95-0000-1000-8000-00805F9B34FB",
        "command_read_uuid": "00000052-0000-1000-8000-00805F9B34FB",
        "command_write_uuid": "00000051-0000-1000-8000-00805F9B34FB",
        "encryption_required": true,
        "data_reading_note": "⚠️ After authentication completes, BLE connection DISCONNECTS. All data reading (battery, sensors, etc.) happens via BT_CLASSIC/SPP only. BLE characteristics above are ONLY used during the AUTH phase.",
        "spp_protocol": {
            "version": "v1",
            "version_detection": {
                "enabled": true,
                "send_version_request_v1": true,
                "channel": 0,
                "opcode": 0,
                "timeout_ms": 5000,
                "auto_switch_threshold": 2,
                "note": "Send VERSION request in V1 format, parse response byte[0]. If >= 2, switch to V2. Band 9 firmware may have been updated; auto-detection ensures compatibility."
            },
            "v1": {
                "packet_preamble": [
                    186,
                    220,
                    254
                ],
                "packet_epilogue": [
                    239
                ],
                "channels": {
                    "version": 0,
                    "proto_rx": 1,
                    "proto_tx": 2,
                    "authentication": 2,
                    "fitness": 3,
                    "voice": 4,
                    "mass": 5,
                    "ota": 7
                },
                "opcodes": {
                    "read": 0,
                    "send": 2
                },
                "data_types": {
                    "plain": 0,
                    "encrypted": 1,
                    "auth": 2
                }
            },
            "v1_note": "All SPP V1 protocol values are UNIVERSAL across Xiaomi devices (hardcoded in code). See lib/shared/services/bluetooth/xiaomi/protocol/v1/constants.dart"
        },
        "auth_flow": {
            "step_1": "Send CMD_NONCE (type=1, subtype=26) with phoneNonce as SPP packet",
            "step_2": "Receive watchNonce + HMAC verification as SPP packet",
            "step_3": "Send CMD_AUTH (type=1, subtype=27) with encrypted device info as SPP packet",
            "step_4": "Receive confirmation (status=1 for success)"
        },
        "notes": "Smart Band 9 uses SPP Protocol V1 by default but can auto-detect if firmware is updated to V2 (Gadgetbridge source confirms auto-detection logic). Unlike Band 10, V1 does NOT require SESSION_CONFIG handshake. Based on Gadgetbridge XiaomiSppProtocolV1.java + XiaomiSppPacketV1.java. Both Band 9 and Band 10 use BT_CLASSIC/SPP after initial BLE authentication phase; the SPP protocol version determines packet structure."
    }
}