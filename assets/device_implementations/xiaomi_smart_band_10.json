{
    "version": "2.1",
    "device_type": "xiaomi_smart_band_10",
    "display_name": "Xiaomi Smart Band 10 (SPP Auto-detect V2)",
    "capabilities": {
        "heart_rate": true,
        "hrv": true,
        "accelerometer": false,
        "rem_detection_mode": "hr_hrv_only",
        "expected_rem_accuracy": "70-80%"
    },
    "service_filter": [
        "0000FE95-0000-1000-8000-00805F9B34FB"
    ],
    "services": {
        "FE95": {
            "uuid": "0000FE95-0000-1000-8000-00805F9B34FB",
            "name": "Xiaomi Encrypted Service",
            "characteristics": {
                "device_info": {
                    "uuid": "00000050-0000-1000-8000-00805F9B34FB",
                    "properties": [
                        "read"
                    ],
                    "description": "Device information - firmware version, hardware revision, etc. (Read-only)"
                },
                "command_read": {
                    "uuid": "0000005E-0000-1000-8000-00805F9B34FB",
                    "properties": [
                        "write_no_response",
                        "notify"
                    ],
                    "description": "Xiaomi SPP Protocol V2 - AUTH ONLY: RX characteristic for receiving auth responses during BLE authentication phase"
                },
                "command_write": {
                    "uuid": "0000005F-0000-1000-8000-00805F9B34FB",
                    "properties": [
                        "write_no_response",
                        "notify"
                    ],
                    "description": "Xiaomi SPP Protocol V2 - AUTH ONLY: TX characteristic for sending auth commands during BLE authentication phase"
                }
            }
        }
    },
    "data_parsers": {},
    "authentication": {
        "protocol": "xiaomi_spp",
        "connection_type": "spp_over_ble",
        "service_uuid": "0000FE95-0000-1000-8000-00805F9B34FB",
        "command_read_uuid": "0000005E-0000-1000-8000-00805F9B34FB",
        "command_write_uuid": "0000005F-0000-1000-8000-00805F9B34FB",
        "encryption_required": true,
        "data_reading_note": "⚠️ After authentication completes, BLE connection DISCONNECTS and switches to BT_CLASSIC/SPP. All data reading (battery, sensors, etc.) happens via BT_CLASSIC/SPP only. BLE characteristics above are ONLY used during the AUTH phase.",
        "spp_protocol": {
            "version": "v2",
            "version_detection": {
                "enabled": true,
                "send_version_request_v1": true,
                "channel": 0,
                "opcode": 0,
                "timeout_ms": 5000,
                "auto_switch_threshold": 2,
                "note": "Send VERSION request in V1 format, parse response byte[0]. If >= 2, switch to V2."
            },
            "v1": {
                "packet_preamble": [
                    186,
                    220,
                    254
                ],
                "packet_epilogue": [
                    239
                ],
                "channels": {
                    "version": 0,
                    "proto_rx": 1,
                    "proto_tx": 2,
                    "authentication": 2,
                    "fitness": 3,
                    "voice": 4,
                    "mass": 5,
                    "ota": 7
                },
                "opcodes": {
                    "read": 0,
                    "send": 2
                },
                "data_types": {
                    "plain": 0,
                    "encrypted": 1,
                    "auth": 2
                }
            },
            "v2_note": "All SPP V2 protocol values are UNIVERSAL across Xiaomi devices (hardcoded in code). See lib/shared/services/bluetooth/xiaomi/protocol/v2/constants.dart"
        },
        "auth_flow": {
            "step_0": "Send VERSION request (V1 format) → Receive version byte → Auto-switch to V2 if >= 2",
            "step_1_v2": "Send SESSION_CONFIG request (opcode=1) → Receive SESSION_CONFIG response (opcode=2)",
            "step_2": "Send CMD_NONCE (type=1, subtype=26) with phoneNonce as SPP V2 DATA packet",
            "step_3": "Receive watchNonce + HMAC verification as SPP V2 DATA packet → Send ACK",
            "step_4": "Send CMD_AUTH (type=1, subtype=27) with encrypted device info as SPP V2 DATA packet",
            "step_5": "Receive confirmation (status=1 for success) as SPP V2 DATA packet → Send ACK"
        },
        "notes": "Smart Band 10 CONFIRMED to use SPP Protocol V2 (Gadgetbridge source code MiBand10Coordinator.java). Requires session handshake (SESSION_CONFIG) before authentication - this is the KEY difference from V1. Auto-detected via VERSION request during auth. Based on Gadgetbridge XiaomiSppProtocolV2.java + XiaomiSppPacketV2.java. Band 9 and Band 10 both use BT_CLASSIC/SPP after BLE auth phase, but differ in packet format and SESSION_CONFIG requirement."
    }
}